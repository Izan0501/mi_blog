{% extends "pages/base.html" %}
{% load static %}
{% block title %} Perfil {% endblock %}
{% block content %}

{% if messages %}
<div class="messages-container">
    {% for message in messages %}
    <div class="message {{ message.tags }}">
        {{ message }}
        <button class="close-btn" onclick="this.parentElement.style.display='none'">&times;</button>
    </div>
    {% endfor %}
</div>
{% endif %}

<div class="profile-wrapper">
    <!-- Header del perfil -->
    <header class="profile-header">
        <div class="profile-avatar">
            {% if user.imagen_perfil %}
            <img src="{{ user.imagen_perfil.url }}" alt="Imagen de perfil">
            {% else %}
            <img src="{% static 'images/default-profile.png' %}" alt="Sin imagen">
            {% endif %}
        </div>
        <div class="profile-info">
            <h1 class="profile-name">{{ user.username }}</h1>
            {% if user.rol == "admin" %}
            <a href="{% url 'lista_usuarios' %}" class="btn-admin view-btn">Ver Usuarios</a>
            {% endif %}
            {% if user.rol == "admin" %}
            <a href="{% url 'publicaciones_usuarios' %}" class="btn-admin">Ver publicaciones</a>
            {% endif %}
            <a href="#" class="btn-edit1" onclick="openModal()">Editar perfil</a>
            <a href="{% url 'logout' %}" class="btn-logout">Cerrar sesión</a>
        </div>
    </header>

    <!-- Publicaciones -->
    <section class="profile-posts">
        <h2>Mis Publicaciones</h2>
        <ul class="post-list">
            {% for articulo in publicaciones %}
            <li class="post-card">
                <h3>{{ articulo.titulo }}</h3>
                <p>{{ articulo.contenido|truncatewords:30 }}</p>
                <div class="post-actions">
                    <a href="{% url 'detalle_articulo' articulo.id_articulo %}" class="btn-view">Ver</a>
                    <a href="{% url 'editar_publicacion' articulo.id_articulo %}" class="btn-edit">Editar</a>
                    <form method="post" action="{% url 'eliminar_articulo' articulo.id_articulo %}">
                        {% csrf_token %}
                        <button type="submit" class="btn-delete">Eliminar</button>
                    </form>
                </div>
            </li>
            {% empty %}
            <p class="empty-message">
                <ion-icon name="document-outline"></ion-icon>
                No has publicado ningún artículo aún.
            </p>
            {% endfor %}
        </ul>
    </section>
</div>

<!-- Modal -->
<div id="editModal" class="modal">
    <div class="modal-dialog">
        <div class="modal-header">
            <h2>Editar Perfil</h2>
            <span class="close-modal" onclick="closeModal()">&times;</span>
        </div>
        <div class="modal-body">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit" class="btn-save">Guardar cambios</button>
            </form>
        </div>
    </div>
</div>

<script>
    function openModal() {
        document.getElementById("editModal").style.display = "flex";
    }
    function closeModal() {
        document.getElementById("editModal").style.display = "none";
    }
</script>

{% endblock %}