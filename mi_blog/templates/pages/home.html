{% extends "pages/base.html" %}

{% load static %}

{% block title %} Inicio {% endblock %}

{% block content %}
{% if messages %}
<div class="messages-container">
    {% for message in messages %}
    <div class="message {{ message.tags }}">
        {{ message }}
        <button class="close-btn" onclick="this.parentElement.style.display='none'">&times;</button>
    </div>
    {% endfor %}
</div>
{% endif %}

<article>
    <!-- search-ajax -->
    <div id="search-results" class="search-results glass-dropdown" style="display:none;">
        <!--partials/search_results.html -->
    </div>
    <!-- search-ajaxEnds -->

    <!-- TopicSection -->
    <section class="topics" id="topics" aria-labelledby="topic-label">
        <div class="container">

            <h2 class="headline headline-2 section-title">
                <span class="span">Whats New?</span>
            </h2>

            <div class="card topic-card">

                <div class="card-content">

                    <h2 class="headline headline-2 section-title card-title" id="topic-label">
                        Hot topics
                    </h2>

                    <p class="card-text">
                        No te pierdas lo mas popular entre nuestros lectores, entre diversas categorias y temas.
                    </p>

                    <div class="btn-group">
                        <button class="btn-icon" aria-label="previous" data-slider-prev>
                            <ion-icon name="arrow-back" aria-hidden="true"></ion-icon>
                        </button>

                        <button class="btn-icon" aria-label="next" data-slider-next>
                            <ion-icon name="arrow-forward" aria-hidden="true"></ion-icon>
                        </button>
                    </div>

                </div>

                <div class="slider" data-slider>
                    <ul class="slider-list" data-slider-container>
                        {% for articulo in articulos_populares %}
                        <li class="slider-item">
                            <a href="{% url 'detalle_articulo' articulo.id_articulo %}" class="slider-card">

                                <figure class="slider-banner img-holder" style="--width: 507; --height: 618;">
                                    {% if articulo.imagen_portada %}
                                    <img src="{{ articulo.imagen_portada.url }}" width="507" height="618" loading="lazy"
                                        alt="{{ articulo.titulo }}" class="img-cover">
                                    {% else %}
                                    <img src="{% static 'images/default-article.png' %}" width="507" height="618"
                                        loading="lazy" alt="Sin imagen" class="img-cover">
                                    {% endif %}
                                </figure>

                                <div class="slider-content">
                                    <span class="slider-title">{{ articulo.titulo }}</span>

                                    <p class="slider-subtitle">
                                        ❤️ {{ articulo.num_likes }} · {{ articulo.fecha_creacion|date:"d M Y" }}
                                    </p>

                                    <div class="author-info"
                                        style="display:flex;align-items:center;gap:8px;margin-top:8px;">
                                        {% if articulo.autor.imagen_perfil %}
                                        <img src="{{ articulo.autor.imagen_perfil.url }}"
                                            alt="{{ articulo.autor.username }}" class="author-avatar"
                                            style="width:28px;height:28px;border-radius:50%;">
                                        {% else %}
                                        <img src="{% static 'images/default-profile.png' %}" alt="Perfil"
                                            class="author-avatar" style="width:28px;height:28px;border-radius:50%;">
                                        {% endif %}
                                        <span class="author-name">{{ articulo.autor.username }}</span>
                                    </div>
                                </div>

                            </a>
                        </li>
                        {% empty %}
                        <p style="margin-left: 40%;" class="empty-message">No hay artículos con likes aún.</p>
                        {% endfor %}
                    </ul>
                </div>
            </div>
        </div>
    </section>
    <!-- TopicSectionEnds -->

    <!-- FeaturedSection -->
    <section class="section feature" aria-label="feature" id="featured">

        <div class="container">

            <h2 class="headline headline-2 section-title">
                <span class="span">Principal Posts</span>
            </h2>

            <p class="section-text">
                Featured and highly rated articles
            </p>

            <ul class="feature-list">
                {% for articulo in articulos_generales %}
                <li>
                    <div class="card feature-card">
                        {% if articulo.imagen_portada %}
                        <figure class="card-banner img-holder" style="--width: 1602; --height: 903;">
                            <img src="{{ articulo.imagen_portada.url }}" width="1602" height="903" loading="lazy"
                                alt="{{ articulo.titulo }}" class="img-cover">
                        </figure>
                        {% endif %}
                        <div class="card-content">
                            <div class="card-wrapper">
                                <div class="card-tag">
                                    <a href="#" class="span hover-2"># {{ articulo.categoria.nombre }}</a>
                                </div>
                                <div class="wrapper">
                                    <ion-icon name="time-outline" aria-hidden="true"></ion-icon>
                                    <span class="span">{{ articulo.fecha_creacion|timesince }}</span>
                                </div>
                            </div>

                            <h3 class="headline headline-3">
                                <a href="#" class="card-title hover-2">
                                    {{ articulo.contenido|truncatewords:10 }}
                                </a>
                            </h3>

                            <div class="card-wrapper">
                                <div class="profile-card">
                                    {% if articulo.autor.imagen_perfil %}
                                    <img src="{{ articulo.autor.imagen_perfil.url }}" width="48" height="48"
                                        loading="lazy" alt="{{ articulo.autor.username }}" class="profile-banner">
                                    {% else %}
                                    <img src="{% static 'images/default-profile.png' %}" width="48" height="48"
                                        loading="lazy" alt="Sin imagen" class="profile-banner">
                                    {% endif %}
                                    <div>
                                        <p class="card-title">{{ articulo.autor.username }}</p>
                                        <p class="card-subtitle">{{ articulo.fecha_creacion|date:"d M Y" }}</p>
                                    </div>
                                </div>
                                <div class="card-actions">
                                    <a href="{% url 'toggle_like' 'articulo' articulo.id_articulo %}"
                                        class="like-btn {% if articulo.id_articulo in likes_usuario %}liked{% endif %}">
                                        <ion-icon name="heart"></ion-icon>
                                    </a>
                                    {% if usuarios_like %}
                                    <span class="like-info">
                                        {% for u in usuarios_like %}
                                        {{ u.username }}{% if not forloop.last %}, {% endif %}
                                        {% endfor %}
                                        {% if likes.count > 2 %} y otros...{% endif %}
                                    </span>
                                    {% endif %}
                                </div>
                            </div>
                            <a class="btn-readmore" href="{% url 'detalle_articulo' articulo.id_articulo %}"
                                class="btn-readmore">Leer
                                más</a>
                        </div>
                    </div>
                </li>
                {% empty %}
                <p class="empty-message">No hay artículos publicados aún.</p>
                {% endfor %}
            </ul>
            <a href="#" class="btn btn-secondary">
                <span class="span">Show More Posts</span>

                <ion-icon name="arrow-forward" aria-hidden="true"></ion-icon>
            </a>
        </div>
    </section>
    <!-- FeaturedSectionEnds -->

    <!-- TagSection -->
    <section class="tags" aria-labelledby="tag-label">
        <div class="container">
            <h2 class="headline headline-2 section-title" id="tag-label">
                <span class="span">Recent Tags</span>
            </h2>
            <ul class="grid-list">
                {% for categoria in categorias %}
                <li>
                    <a href="?categoria={{ categoria.id_categoria }}#articulos-filtrados"
                        class="card tag-btn {% if categoria.id_categoria == categoria_activa %}active-tag{% endif %}">
                        <p class="btn-text">#{{ categoria.nombre }}</p>
                    </a>
                </li>
                {% endfor %}
            </ul>
        </div>
    </section>
    <!-- TagSectionEnds -->

    <!-- filterTags -->
    {% if categoria_activa %}
    <section id="articulos-filtrados" class="glass-container">
        <h2 class="headline headline-2 section-title">
            <span class="span">#{{ categoria_nombre }}</span>
        </h2>

        {% if articulos_filtrados %}
        <ul class="grid-list">
            {% for articulo in articulos_filtrados %}
            <li>
                <article class="filter-card">
                    <div class="card-image-wrapper">
                        <a href="{% url 'detalle_articulo' articulo.pk %}">
                            {% if articulo.imagen_portada %}
                            <img src="{{ articulo.imagen_portada.url }}" alt="{{ articulo.titulo }}" class="card-image">
                            {% else %}
                            <div class="card-image placeholder"></div>
                            {% endif %}
                        </a>
                        <span class="card-category">#{{ articulo.categoria.nombre }}</span>
                    </div>

                    <div class="card-body">
                        <h3 class="card-title">
                            <a href="{% url 'detalle_articulo' articulo.pk %}">
                                {{ articulo.titulo }}
                            </a>
                        </h3>
                        <p class="card-excerpt">{{ articulo.contenido|truncatewords:25 }}</p>

                        <div class="card-footer">
                            <div class="author-info">
                                {% if articulo.autor.imagen_perfil %}
                                <img src="{{ articulo.autor.imagen_perfil.url }}" alt="{{ articulo.autor.username }}"
                                    class="author-avatar">
                                {% else %}
                                <img src="{% static 'images/default-profile.png' %}" alt="Sin imagen"
                                    class="author-avatar">
                                {% endif %}
                                <div>
                                    <p class="author-name">{{ articulo.autor.username }}</p>
                                    <p class="publish-date">{{ articulo.fecha_creacion|date:"d M Y" }}</p>
                                </div>
                            </div>
                            <span class="time-since">{{ articulo.fecha_creacion|timesince }}</span>
                        </div>
                        <a href="{% url 'detalle_articulo' articulo.id_articulo %}" class="btn-readmore">Leer
                            más</a>
                    </div>
                </article>
            </li>
            {% endfor %}
        </ul>
        {% else %}
        <p class="empty-message">No hay artículos en esta categoría.</p>
        {% endif %}
    </section>
    {% endif %}
    <!-- filterTagsEnds -->

    <!-- RecentPostSection -->
    <section class="section recent-post" id="recent" aria-labelledby="recent-label">
        <div class="container">

            <div class="post-main">

                <h2 class="headline headline-2 section-title">
                    <span class="span">Recent posts</span>
                </h2>

                <p class="section-text">
                    Don't miss the latest trends
                </p>

                <ul class="grid-list">
                    {% for articulo in articulos_generales %}
                    <li>
                        <div class="recent-post-card">

                            {% if articulo.imagen_portada %}
                            <figure class="card-banner img-holder" style="--width: 271; --height: 258;">
                                <img src="{{ articulo.imagen_portada.url }}" width="271" height="258" loading="lazy"
                                    alt="{{ articulo.titulo }}" class="img-cover">
                            </figure>
                            {% endif %}

                            <div class="card-content">

                                <a href="#" class="card-badge">{{ articulo.categoria.nombre }}</a>

                                <h3 class="headline headline-3 card-title">
                                    <a href="{% url 'detalle_articulo' articulo.id_articulo %}" class="link hover-2">
                                        {{ articulo.titulo }}
                                    </a>
                                </h3>

                                <p class="card-text">
                                    {{ articulo.contenido|truncatewords:20 }}
                                </p>

                                <div class="card-wrapper">
                                    <div class="card-tag">
                                        <a href="#" class="span hover-2"># {{ articulo.categoria.nombre }}</a>
                                    </div>

                                    <div class="wrapper">
                                        <ion-icon name="time-outline" aria-hidden="true"></ion-icon>
                                        <span class="span">{{ articulo.fecha_creacion|timesince }}</span>
                                    </div>
                                </div>

                            </div>

                        </div>
                    </li>
                    {% empty %}
                    <li>
                        <p class="empty-message">No hay artículos publicados aún.</p>
                    </li>
                    {% endfor %}
                </ul>
                <nav aria-label="pagination" class="pagination">

                    <a href="#" class="pagination-btn" aria-label="previous page">
                        <ion-icon name="arrow-back" aria-hidden="true"></ion-icon>
                    </a>

                    <a href="#" class="pagination-btn">1</a>
                    <a href="#" class="pagination-btn">2</a>
                    <a href="#" class="pagination-btn">3</a>
                    <a href="#" class="pagination-btn" aria-label="more page">...</a>

                    <a href="#" class="pagination-btn" aria-label="next page">
                        <ion-icon name="arrow-forward" aria-hidden="true"></ion-icon>
                    </a>

                </nav>
            </div>

            <div class="post-aside grid-list">
                <!-- popularPosts -->
                <div class="card aside-card">

                    <h3 class="headline headline-2 aside-title">
                        <span class="span">Popular Posts</span>
                    </h3>

                    <ul class="popular-list">
                        {% for articulo in articulos_populares %}
                        <li>
                            <div class="popular-card">

                                <figure class="card-banner img-holder" style="--width: 64; --height: 64;">
                                    {% if articulo.imagen_portada %}
                                    <img src="{{ articulo.imagen_portada.url }}" width="64" height="64" loading="lazy"
                                        alt="{{ articulo.titulo }}" class="img-cover">
                                    {% else %}
                                    <img src="{% static 'images/default-article.png' %}" width="64" height="64"
                                        loading="lazy" alt="Sin imagen" class="img-cover">
                                    {% endif %}
                                </figure>

                                <div class="card-content">
                                    <h4 class="headline headline-4 card-title">
                                        <a href="{% url 'detalle_articulo' articulo.id_articulo %}"
                                            class="link hover-2">
                                            {{ articulo.titulo }}
                                        </a>
                                    </h4>

                                    <p class="card-description">
                                        {{ articulo.contenido|truncatewords:15 }}
                                    </p>

                                    <div class="warpper">
                                        <p class="card-subtitle">❤️ {{ articulo.num_likes }}</p>
                                        <time class="publish-date"
                                            datetime="{{ articulo.fecha_creacion|date:'Y-m-d' }}">
                                            {{ articulo.fecha_creacion|date:"d M Y" }}
                                        </time>
                                    </div>

                                    <div class="author-info"
                                        style="display:flex;align-items:center;gap:8px;margin-top:8px;">
                                        {% if articulo.autor.imagen_perfil %}
                                        <img src="{{ articulo.autor.imagen_perfil.url }}"
                                            alt="{{ articulo.autor.username }}" class="author-avatar"
                                            style="width:28px;height:28px;border-radius:50%;">
                                        {% else %}
                                        <img src="{% static 'images/default-profile.png' %}" alt="Perfil"
                                            class="author-avatar" style="width:28px;height:28px;border-radius:50%;">
                                        {% endif %}
                                        <span class="author-name">{{ articulo.autor.username }}</span>
                                    </div>
                                </div>

                            </div>
                        </li>
                        {% empty %}
                        <p class="empty-message">No hay artículos con likes aún.</p>
                        {% endfor %}
                    </ul>
                </div>
                <!-- lastComments -->
                <div class="card aside-card">

                    <h3 class="headline headline-2 aside-title">
                        <span class="span">Last Comments</span>
                    </h3>

                    <ul class="comment-list">

                        {% for comentario in comentarios_recientes %}
                        <li>
                            <div class="comment-card">

                                <!-- Texto del comentario -->
                                <blockquote class="card-text">
                                    “ {{ comentario.contenido|truncatewords:20 }} ”
                                </blockquote>

                                <!-- Perfil del usuario -->
                                <div class="profile-card">
                                    <figure class="profile-banner img-holder">
                                        {% if comentario.usuario and comentario.usuario.imagen_perfil %}
                                        <img src="{{ comentario.usuario.imagen_perfil.url }}" width="32" height="32"
                                            loading="lazy" alt="{{ comentario.usuario.username }}">
                                        {% else %}
                                        <img src="{% static 'images/default-profile.png' %}" width="32" height="32"
                                            loading="lazy" alt="Perfil">
                                        {% endif %}
                                    </figure>

                                    <div>
                                        <p class="card-title">
                                            {% if comentario.usuario %}
                                            {{ comentario.usuario.username }}
                                            {% else %}
                                            Anónimo
                                            {% endif %}
                                        </p>

                                        <time class="card-date" datetime="{{ comentario.fecha_creacion|date:'Y-m-d' }}">
                                            {{ comentario.fecha_creacion|date:"d M Y" }}
                                        </time>
                                    </div>
                                </div>

                            </div>
                        </li>
                        {% empty %}
                        <p class="empty-message">
                            <ion-icon name="chatbubble-outline"></ion-icon>
                            No hay comentarios recientes.
                        </p>
                        {% endfor %}
                    </ul>
                </div>
                <!-- instaPublish -->
                <div class="card aside-card insta-card">

                    <a href="#" class="nav-logo">
                        MiBlog
                    </a>

                    <p class="card-text">
                        Follow us on instagram
                    </p>

                    <ul class="insta-list">

                        <li>
                            <a href="#" class="insta-post img-holder" style="--width: 276; --height: 277;">
                                <img src="{% static 'images/insta-post-1.png' %}" width="276" height="277"
                                    loading="lazy" alt="insta post" class="img-cover">
                            </a>
                        </li>

                        <li>
                            <a href="#" class="insta-post img-holder" style="--width: 276; --height: 277;">
                                <img src="{% static 'images/insta-post-2.png' %}" width="276" height="277"
                                    loading="lazy" alt="insta post" class="img-cover">
                            </a>
                        </li>

                        <li>
                            <a href="#" class="insta-post img-holder" style="--width: 276; --height: 277;">
                                <img src="{% static 'images/insta-post-3.png' %}" width="276" height="277"
                                    loading="lazy" alt="insta post" class="img-cover">
                            </a>
                        </li>

                        <li>
                            <a href="#" class="insta-post img-holder" style="--width: 276; --height: 277;">
                                <img src="{% static 'images/insta-post-4.png' %}" width="276" height="277"
                                    loading="lazy" alt="insta post" class="img-cover">
                            </a>
                        </li>

                        <li>
                            <a href="#" class="insta-post img-holder" style="--width: 276; --height: 277;">
                                <img src="{% static 'images/insta-post-5.png' %}" width="276" height="277"
                                    loading="lazy" alt="insta post" class="img-cover">
                            </a>
                        </li>

                        <li>
                            <a href="#" class="insta-post img-holder" style="--width: 276; --height: 277;">
                                <img src="{% static 'images/insta-post-6.png' %}" width="276" height="277"
                                    loading="lazy" alt="insta post" class="img-cover">
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </section>
    <!-- RecentPostSectionEnds -->
</article>
{% endblock %}