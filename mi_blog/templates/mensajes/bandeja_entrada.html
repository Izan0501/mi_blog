{% extends 'pages/base.html' %}
{% load static %}
{% block content %}
<section class="mensajes-wrapper">
  <div class="mensajes-header">
    <h2>Bandeja de Entrada ğŸ“©</h2>
  </div>

  {% if chats %}
  <ul class="mensajes-grid">
    {% for mensaje in chats %}
    <li class="mensaje-card {% if not mensaje.leido and mensaje.destinatario == user %}no-leido{% endif %}">
      {% if mensaje.remitente == user %}
      <a href="{% url 'detalle_mensaje' mensaje.destinatario.id %}" class="mensaje-link">
        {% else %}
        <a href="{% url 'detalle_mensaje' mensaje.remitente.id %}" class="mensaje-link">
          {% endif %}
          <div class="mensaje-top">
            <div class="mensaje-user">
              {% if mensaje.remitente == user %}
              {% with otro=mensaje.destinatario %}
              {% if otro.imagen_perfil %}
              <img src="{{ otro.imagen_perfil.url }}" alt="Avatar" class="mensaje-avatar">
              {% else %}
              <img src="{% static 'images/default-profile.png' %}" alt="Avatar" class="mensaje-avatar">
              {% endif %}
              <span class="mensaje-username">{{ otro.username }}</span>
              {% endwith %}
              {% else %}
              {% if mensaje.remitente.imagen_perfil %}
              <img src="{{ mensaje.remitente.imagen_perfil.url }}" alt="Avatar" class="mensaje-avatar">
              {% else %}
              <img src="{% static 'images/default-profile.png' %}" alt="Avatar" class="mensaje-avatar">
              {% endif %}
              <span class="mensaje-username">{{ mensaje.remitente.username }}</span>
              {% endif %}
            </div>
            <span class="mensaje-fecha">{{ mensaje.fecha_envio|date:"d/m/Y H:i" }}</span>
          </div>
          <div class="mensaje-body">
            <p>{{ mensaje.contenido|truncatewords:25 }}</p>
          </div>
        </a>
    </li>
    {% endfor %}
  </ul>
  {% else %}
  <p class="empty-message">âœ¨ No tienes conversaciones aÃºn. Â¡EnvÃ­a el primero!</p>
  {% endif %}
</section>
{% endblock %}